<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astra AI - Cybersecurity Operations Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            padding-top: 120px; /* Adjust for fixed header */
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .bg-gradient-custom {
            background: linear-gradient(135deg, #1a1a3d 0%, #0c0c24 100%);
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .nav-link.active-link {
            background-color: #3b82f6;
            color: white;
        }
        .tab-btn.active-tab {
            color: white;
            border-bottom: 2px solid #3b82f6;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }
        
        .threat-item {
            transition: all 0.3s ease;
        }
        
        .threat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-custom text-gray-200">

    <header class="fixed top-0 left-0 right-0 z-10 glass-effect p-4 border-b border-gray-700/50">
        <div class="flex justify-between items-center mb-4">
             <div class="flex items-center">
                <svg class="w-8 h-8 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                <div>
                    <h1 class="text-xl font-bold text-glow text-white">Astra AI</h1>
                    <p class="text-xs text-gray-400">CYBERSECURITY OPERATIONS CENTER</p>
                </div>
            </div>
            <div class="text-right">
                <span class="inline-block bg-green-500/20 text-green-300 text-sm font-semibold px-3 py-1 rounded-full">● SYSTEM ONLINE</span>
                <p class="text-gray-400 text-xs mt-1" id="currentTime">THREAT LEVEL: <span class="text-yellow-400 font-bold">ELEVATED</span></p>
            </div>
        </div>
        <nav class="flex space-x-2">
            <a href="#dashboard" class="nav-link active-link flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-blue-600 hover:text-white rounded-md transition duration-300"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>Dashboard</a>
            <a href="#content-analysis" class="nav-link flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-blue-600 hover:text-white rounded-md transition duration-300"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>Content Analysis</a>
            <a href="#social-simulation" class="nav-link flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-blue-600 hover:text-white rounded-md transition duration-300"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>Social Simulation</a>
            <a href="#ai-learning" class="nav-link flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-blue-600 hover:text-white rounded-md transition duration-300"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>AI Learning</a>
        </nav>
    </header>

    <!-- Reporting Modal -->
    <div id="reportModal" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center">
        <div class="glass-effect rounded-xl p-6 max-w-md w-full mx-4 border border-gray-600">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Report to Cybercrime Portal</h3>
                <button id="closeModal" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="selectedThreatInfo" class="bg-gray-800/50 p-3 rounded-lg mb-4">
                <!-- Selected threat info will be populated here -->
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Additional Details (Optional)</label>
                    <textarea id="additionalDetails" class="w-full bg-gray-900/50 p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="Provide any additional context or evidence..." rows="3"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Your Contact (Optional)</label>
                    <input type="email" id="reporterContact" class="w-full bg-gray-900/50 p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="your.email@example.com">
                </div>
                
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="urgentReport" class="rounded bg-gray-900 border-gray-700">
                    <label for="urgentReport" class="text-sm text-gray-300">Mark as urgent</label>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button id="submitReport" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    Report to Cybercrime.gov.in
                </button>
                <button id="cancelReport" class="px-4 py-3 text-gray-400 hover:text-white transition duration-300">Cancel</button>
            </div>
        </div>
    </div>

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">

            <!-- Dashboard Section -->
            <section id="dashboard" class="page-section">
                <header class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-glow text-white">AICMS </h2>
                    <h6>(Anti-India Campaign Monitoring System) </h6>

                    <p class="text-gray-400 mt-2">Advanced AI-powered threat detection system for identifying and analyzing anti-India campaigns across digital platforms.</p>
                     <div class="flex justify-center space-x-6 mt-4 text-sm text-gray-300">
                        <span><span class="text-green-400">○</span> Regulatory Compliant</span>
                        <span><span class="text-blue-400">○</span> Cybercrime.gov.in Integration</span>
                        <span><span class="text-purple-400">○</span> AI Learning Enabled</span>
                    </div>
                </header>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">Threats Detected</h3><p class="text-4xl font-bold text-white" id="threatsDetected">216</p><p class="text-red-400 text-sm" id="threatsDetectedChange">+9 from last hour</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">Threats Blocked</h3><p class="text-4xl font-bold text-white" id="threatsBlocked">101</p><p class="text-green-400 text-sm" id="threatsBlockedChange">+6 from last hour</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">System Load</h3><p class="text-4xl font-bold text-white" id="systemLoad">30.5%</p><p class="text-yellow-400 text-sm" id="systemLoadChange">+2.0% from last hour</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">Uptime</h3><p class="text-4xl font-bold text-white" id="uptime">99.85%</p><p class="text-green-400 text-sm" id="uptimeChange">+0.0% from last hour</p></div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-1 glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4 text-white">Anti-India Campaign Intelligence <span class="text-xs text-red-400 font-semibold">REAL-TIME</span></h3>
                        <div class="relative h-64">
                             <svg class="w-full h-full" viewBox="0 0 200 150">
                                <path d="M 10 75 Q 50 10, 90 60 T 190 80" stroke="#4A5568" fill="none" stroke-width="1" />
                                <path d="M 20 20 Q 70 90, 150 110 T 180 40" stroke="#4A5568" fill="none" stroke-width="1" />
                                <circle cx="50" cy="50" r="4" fill="#FBBF24" class="animate-pulse" />
                                <circle cx="150" cy="80" r="4" fill="#FBBF24" class="animate-pulse" style="animation-delay: 0.5s;" />
                                <circle cx="90" cy="110" r="4" fill="#FBBF24" class="animate-pulse" style="animation-delay: 1s;" />
                                <circle cx="100" cy="75" r="10" fill="#3B82F6" />
                                <text x="100" y="78" font-size="6" fill="white" text-anchor="middle">INDIA PROTECTED</text>
                            </svg>
                        </div>
                        <div class="mt-4 text-sm">
                            <p><span class="text-red-400 font-bold">Critical:</span> 16 Campaigns</p>
                            <p><span class="text-yellow-400 font-bold">High:</span> 10 Campaigns</p>
                            <p><span class="text-blue-400 font-bold">Medium:</span> 5 Campaigns</p>
                            <p><span class="text-gray-400 font-bold">Low:</span> 23 Campaigns</p>
                        </div>
                    </div>
                     <div class="lg:col-span-2 glass-effect p-6 rounded-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-white">Live Anti-India Campaign Alerts <span class="text-xs text-red-400 font-semibold">ACTIVE</span></h3>
                            <button id="summarizeBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm">✨ Summarize Alerts</button>
                        </div>
                        <div id="summaryResult" class="hidden mb-4 bg-gray-800/50 p-3 rounded-lg text-sm"></div>
                        <div class="flex border-b border-gray-700 mb-4">
                            <button class="tab-btn active-tab py-2 px-4 text-gray-400" data-filter="all">All (20)</button>
                            <button class="tab-btn py-2 px-4 text-gray-400" data-filter="critical">Critical (4)</button>
                            <button class="tab-btn py-2 px-4 text-gray-400" data-filter="high">High (11)</button>
                            <button class="tab-btn py-2 px-4 text-gray-400" data-filter="low">Low (5)</button>
                        </div>
                        <div id="threat-list" class="space-y-3 max-h-80 overflow-y-auto">
                            <!-- Threats will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
                
                 <div class="glass-effect p-6 rounded-xl">
                    <h3 class="text-xl font-bold mb-4 text-white">Platform Campaign Analytics <span class="text-xs bg-gray-700 px-2 py-1 rounded">182 CAMPAIGNS</span></h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-5">
                        
                        <!-- Facebook -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">Facebook</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 border border-yellow-500/50">HIGH</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">48</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>5%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 75%"></div></div>
                        </div>

                        <!-- Twitter -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">Twitter</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-red-500/20 text-red-400 border border-red-500/50">CRITICAL</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">36</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>3%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 90%"></div></div>
                        </div>
                        
                        <!-- WhatsApp -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">WhatsApp</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400 border border-blue-500/50">MODERATE</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">28</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                     <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>2%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 60%"></div></div>
                        </div>

                        <!-- Instagram -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">Instagram</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400 border border-blue-500/50">MODERATE</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">23</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                     <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>2%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 55%"></div></div>
                        </div>

                         <!-- Telegram -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">Telegram</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 border border-yellow-500/50">HIGH</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">16</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                     <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>5%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 40%"></div></div>
                        </div>

                         <!-- YouTube -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">YouTube</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-green-500/20 text-green-400 border border-green-500/50">LOW</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">12</p>
                                <div class="flex items-center ml-2 text-sm text-red-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                    <span>8%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 25%"></div></div>
                        </div>

                         <!-- TikTok -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">TikTok</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400 border border-blue-500/50">MODERATE</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">11</p>
                                <div class="flex items-center ml-2 text-sm text-red-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                    <span>1%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 20%"></div></div>
                        </div>

                         <!-- Reddit -->
                        <div class="relative p-4 rounded-xl bg-gradient-to-br from-indigo-900/40 to-purple-900/30 border border-purple-800/50">
                           <div class="flex justify-between items-start">
                               <span class="font-semibold text-gray-200">Reddit</span>
                               <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-green-500/20 text-green-400 border border-green-500/50">LOW</span>
                           </div>
                           <div class="flex items-baseline mt-2 mb-3">
                                <p class="text-4xl font-bold text-white">8</p>
                                <div class="flex items-center ml-2 text-sm text-green-400">
                                     <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                                    <span>9%</span>
                                </div>
                           </div>
                           <p class="text-xs text-gray-400 mb-2">Active Campaigns</p>
                           <div class="w-full bg-gray-700/50 rounded-full h-1.5"><div class="bg-orange-500 h-1.5 rounded-full" style="width: 15%"></div></div>
                        </div>

                    </div>
                </div>

            </section>

            <!-- Content Analysis Section -->
            <section id="content-analysis" class="page-section hidden">
                 <h2 class="text-3xl font-bold text-glow mb-2 text-white">Content Analysis</h2>
                 <p class="text-gray-400 mb-6">AI-powered analysis to detect anti-India campaigns and disinformation.</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div class="glass-effect p-6 rounded-xl">
                         <h3 class="text-xl font-bold text-white mb-4">Content Input</h3>
                         <label class="text-gray-400">URL Analysis</label>
                         <input type="text" id="urlInput" class="w-full bg-gray-900/50 p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" placeholder="Enter social media post URL or website link...">
                         <p class="text-center text-gray-500 my-2">OR</p>
                         <label class="text-gray-400">Text Analysis</label>
                         <textarea id="textContent" class="w-full h-40 bg-gray-900/50 p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Paste social media post, article text..."></textarea>
                         <button id="analyzeBtn" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">✨ Analyze Content</button>
                     </div>
                      <div class="glass-effect p-6 rounded-xl">
                         <h3 class="text-xl font-bold text-white mb-4">Analysis Results</h3>
                         <div id="analysisResult" class="flex items-center justify-center h-full text-gray-500">
                            Enter content to analyze. AI will detect potential threats and anti-India sentiment.
                         </div>
                     </div>
                 </div>
            </section>

            <!-- Social Media Simulation Section -->
            <section id="social-simulation" class="page-section hidden">
                <h2 class="text-3xl font-bold text-glow mb-2 text-white">Social Media Simulation</h2>
                <p class="text-gray-400 mb-6">Create social media posts and see real-time threat detection in action. Experience how our AI identifies anti-India content live!</p>
                
                <!-- Social Media Interface -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    <!-- Post Creation Panel -->
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4 text-white flex items-center">
                            <svg class="w-6 h-6 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                            </svg>
                            Create Social Media Post
                        </h3>
                        
                        <!-- Platform Selection -->
                        <div class="mb-4">
                            <label class="text-sm text-gray-300 block mb-2">Platform</label>
                            <select id="platformSelect" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none">
                                <option value="twitter">Twitter/X</option>
                                <option value="facebook">Facebook</option>
                                <option value="instagram">Instagram</option>
                                <option value="youtube">YouTube</option>
                                <option value="reddit">Reddit</option>
                                <option value="telegram">Telegram</option>
                            </select>
                        </div>
                        
                        <!-- User Profile -->
                        <div class="mb-4 flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                U
                            </div>
                            <div>
                                <input type="text" id="usernameInput" placeholder="@username" class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white text-sm focus:border-blue-500 focus:outline-none" value="@demouser">
                                <p class="text-xs text-gray-400 mt-1">Demo User</p>
                            </div>
                        </div>
                        
                        <!-- Post Content -->
                        <div class="mb-4">
                            <label class="text-sm text-gray-300 block mb-2">Post Content</label>
                            <textarea id="postContent" placeholder="What's happening?" class="w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white h-32 resize-none focus:border-blue-500 focus:outline-none" maxlength="280"></textarea>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-400" id="charCount">0/280</span>
                                <div class="flex space-x-2">
                                    <button id="quickFillCritical" class="bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded">Critical Sample</button>
                                    <button id="quickFillHigh" class="bg-yellow-600 hover:bg-yellow-700 text-white text-xs px-3 py-1 rounded">High Risk</button>
                                    <button id="quickFillSafe" class="bg-green-600 hover:bg-green-700 text-white text-xs px-3 py-1 rounded">Safe Content</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Media Upload Simulation -->
                        <div class="mb-4">
                            <label class="text-sm text-gray-300 block mb-2">Media Content (Simulation)</label>
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-4 text-center">
                                <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="text-sm text-gray-400">Upload image/video for analysis</p>
                                <input type="file" id="mediaUpload" accept="image/*,video/*" class="hidden">
                                <button id="mediaUploadBtn" class="mt-2 bg-gray-700 hover:bg-gray-600 text-white text-xs px-4 py-2 rounded">Choose File</button>
                            </div>
                        </div>
                        
                        <!-- Post Button -->
                        <button id="publishPost" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            Publish Post & Analyze
                        </button>
                    </div>
                    
                    <!-- Live Feed Panel -->
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4 text-white flex items-center">
                            <svg class="w-6 h-6 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2M7 4h10l2 13H5l2-13z"></path>
                            </svg>
                            Live Social Feed
                            <span class="ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full animate-pulse">LIVE</span>
                        </h3>
                        
                        <!-- Real-time Detection Status -->
                        <div class="mb-4 p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-green-400 font-semibold text-sm">Threat Detection: ACTIVE</span>
                                </div>
                                <span class="text-xs text-gray-400" id="detectionStats">Processing in real-time</span>
                            </div>
                        </div>
                        
                        <!-- Posts Feed -->
                        <div id="socialFeed" class="space-y-4 max-h-96 overflow-y-auto">
                            <!-- Posts will be dynamically added here -->
                            <div class="text-center text-gray-400 py-8">
                                <svg class="w-12 h-12 mx-auto mb-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2M7 4h10l2 13H5l2-13z"></path>
                                </svg>
                                <p>Create your first post to see live threat detection!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Real-time Analytics -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="glass-effect p-5 rounded-xl text-center">
                        <h4 class="text-gray-400 text-sm mb-2">Posts Analyzed</h4>
                        <p class="text-3xl font-bold text-white" id="postsAnalyzed">0</p>
                        <p class="text-blue-400 text-xs">This session</p>
                    </div>
                    <div class="glass-effect p-5 rounded-xl text-center">
                        <h4 class="text-gray-400 text-sm mb-2">Threats Detected</h4>
                        <p class="text-3xl font-bold text-red-400" id="threatsDetectedSim">0</p>
                        <p class="text-red-400 text-xs">Critical + High</p>
                    </div>
                    <div class="glass-effect p-5 rounded-xl text-center">
                        <h4 class="text-gray-400 text-sm mb-2">Analysis Speed</h4>
                        <p class="text-3xl font-bold text-green-400" id="analysisSpeed">1.2s</p>
                        <p class="text-green-400 text-xs">Average</p>
                    </div>
                    <div class="glass-effect p-5 rounded-xl text-center">
                        <h4 class="text-gray-400 text-sm mb-2">AI Confidence</h4>
                        <p class="text-3xl font-bold text-yellow-400" id="avgConfidence">--</p>
                        <p class="text-yellow-400 text-xs">Last analysis</p>
                    </div>
                </div>
            </section>

            <!-- AI Learning Center Section -->
            <section id="ai-learning" class="page-section hidden">
                <h2 class="text-3xl font-bold text-glow mb-2 text-white">AI Learning Center</h2>
                <p class="text-gray-400 mb-6">Monitor AI model performance, accuracy metrics, and continuous learning capabilities.</p>
                 <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">Verified Campaigns</h3><p class="text-4xl font-bold text-white" id="verifiedCampaigns">27</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">False Positives</h3><p class="text-4xl font-bold text-white" id="falsePositives">12</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">Total Reports</h3><p class="text-4xl font-bold text-white" id="totalReports">158</p></div>
                    <div class="glass-effect p-5 rounded-xl"><h3 class="text-gray-400">AI Accuracy</h3><p class="text-4xl font-bold text-white" id="aiAccuracy">93.2%</p></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4 text-white">Model Performance</h3>
                        <div class="mb-4">
                            <label class="text-sm">AI Accuracy Rate</label>
                            <div class="w-full bg-gray-700 rounded-full h-2.5 mt-1"><div class="bg-blue-500 h-2.5 rounded-full" style="width: 93.2%;"></div></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div><p class="text-2xl font-bold text-white">828</p><p class="text-sm text-gray-400">Analyses/min</p></div>
                            <div><p class="text-2xl font-bold text-white">2,468</p><p class="text-sm text-gray-400">Daily Analysis</p></div>
                            <div><p class="text-2xl font-bold text-white">95.8%</p><p class="text-sm text-gray-400">Pattern Recognition</p></div>
                            <div><p class="text-2xl font-bold text-white">89.3%</p><p class="text-sm text-gray-400">Real-time Learning</p></div>
                        </div>
                    </div>
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4 text-white">Recent Learning Events <span class="text-xs text-red-400 font-semibold">LIVE</span></h3>
                        <div class="space-y-3">
                            <div class="bg-gray-800/50 p-3 rounded-lg"><p class="font-semibold">Neural network weights updated</p><p class="text-sm text-gray-400">Model v2.4.1</p></div>
                            <div class="bg-gray-800/50 p-3 rounded-lg"><p class="font-semibold text-green-400">Phishing pattern recognition improved</p><p class="text-sm text-gray-400">+2.3% accuracy</p></div>
                            <div class="bg-gray-800/50 p-3 rounded-lg"><p class="font-semibold text-green-400">Reduced false alerts for legitimate traffic</p><p class="text-sm text-gray-400">+1.8% precision</p></div>
                        </div>
                    </div>
                </div>
                 <div class="glass-effect p-6 rounded-xl">
                     <h3 class="text-xl font-bold mb-4 text-white">Law Enforcement Integration <span class="text-xs text-green-400 font-semibold">ACTIVE</span></h3>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                         <div class="bg-gray-800/50 p-4 rounded-lg text-center"><h4 class="font-bold">Cybercrime.gov.in</h4><p class="text-sm text-gray-400">Official Reporting Portal</p><p class="text-green-400 mt-2">Connected</p></div>
                         <div class="bg-gray-800/50 p-4 rounded-lg text-center"><h4 class="font-bold">MP Police CyberShield</h4><p class="text-sm text-gray-400">Regional Coordination</p><p class="text-green-400 mt-2">Synchronized</p></div>
                         <div class="bg-gray-800/50 p-4 rounded-lg text-center"><h4 class="font-bold">AI Feedback Loop</h4><p class="text-sm text-gray-400">Real-time learning</p><p class="text-yellow-400 mt-2 animate-pulse">Training...</p></div>
                     </div>
                 </div>

            </section>
        </main>
    </div>

    <!-- User Information Modal -->
    <div id="userInfoModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-600 rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-white">🕵️ User Intelligence Profile</h3>
                <button onclick="closeUserInfo()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            
            <div id="userInfoContent" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Content will be populated dynamically -->
            </div>
            
            <!-- Interactive Map -->
            <div class="mt-6">
                <h4 class="text-lg font-bold text-white mb-3">📍 Location Intelligence</h4>
                <div id="userLocationMap" class="bg-gray-800 border border-gray-600 rounded-lg h-64 flex items-center justify-center">
                    <p class="text-gray-400">Interactive location map will be displayed here</p>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-6 flex space-x-3">
                <button class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-300">🚨 Flag for Investigation</button>
                <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition duration-300">⚠️ Add to Watchlist</button>
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-300">📄 Generate Report</button>
                <button onclick="closeUserInfo()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-300">Close</button>
            </div>
        </div>
    </div>

    <!-- Footer Status Bar -->
    <footer class="fixed bottom-0 left-0 right-0 glass-effect p-2 px-6 flex justify-between items-center text-xs text-gray-400">
        <div class="flex items-center space-x-4">
            <span><span class="text-green-400">●</span> AI ENGINE: ACTIVE</span>
            <span><span class="text-green-400">●</span> LAW ENFORCEMENT: CONNECTED</span>
            <span><span class="text-green-400">●</span> ML TRAINING: ACTIVE</span>
        </div>
        <span id="lastUpdate"></span>
    </footer>

    <script>
        // --- GLOBAL VARIABLES AND FUNCTIONS ---
        const API_BASE_URL = 'http://localhost:8000/api';
        
        // Global data storage
        let threatsData = [];
        let userProfiles = new Map(); // Store user profiles by ID
        let postCounter = 0; // Counter for unique post IDs
        
        // --- GLOBAL FUNCTIONS FOR ONCLICK EVENTS ---
        
        // User Information Modal Functions  
        function showUserInfoById(postId) {
            const userInfo = userProfiles.get(postId);
            if (!userInfo) {
                console.error('User info not found for post ID:', postId);
                return;
            }
            showUserInfo(userInfo.username, userInfo);
        }
        
        function showUserInfo(username, userInfo) {
            // userInfo is already an object, no need to parse
            
            const modal = document.getElementById('userInfoModal');
            const content = document.getElementById('userInfoContent');
            
            // Risk indicators
            const riskIndicators = [];
            if (userInfo.riskProfile.suspiciousActivity) riskIndicators.push('🚨 Suspicious Activity Detected');
            if (userInfo.riskProfile.multipleAccounts) riskIndicators.push('👥 Multiple Accounts');
            if (userInfo.riskProfile.vpnUsage) riskIndicators.push('🔒 VPN Usage');
            if (userInfo.riskProfile.botLikeBehavior) riskIndicators.push('🤖 Bot-like Behavior');
            
            content.innerHTML = `
                <!-- Personal Information -->
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white mb-3">👤 Personal Information</h4>
                    <div class="space-y-2 text-sm">
                        <p><span class="text-gray-400">Username:</span> <span class="text-white">${userInfo.username}</span></p>
                        <p><span class="text-gray-400">Real Name:</span> <span class="text-white">${userInfo.realName}</span></p>
                        <p><span class="text-gray-400">Platform:</span> <span class="text-white">${userInfo.platform}</span></p>
                        <p><span class="text-gray-400">Account Created:</span> <span class="text-white">${userInfo.accountInfo.joinDate.toLocaleDateString()}</span></p>
                        <p><span class="text-gray-400">Verified:</span> <span class="text-white">${userInfo.accountInfo.verified ? '✅ Yes' : '❌ No'}</span></p>
                    </div>
                </div>
                
                <!-- Location & Network -->
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white mb-3">📍 Location & Network</h4>
                    <div class="space-y-2 text-sm">
                        <p><span class="text-gray-400">IP Address:</span> <span class="text-white font-mono">${userInfo.connection.ipAddress}</span></p>
                        <p><span class="text-gray-400">ISP:</span> <span class="text-white">${userInfo.connection.isp}</span></p>
                        <p><span class="text-gray-400">Network Provider:</span> <span class="text-white">${userInfo.networkProvider}</span></p>
                        <p><span class="text-gray-400">Connection:</span> <span class="text-white">${userInfo.connection.connectionType} (${userInfo.connection.signalStrength})</span></p>
                        <p><span class="text-gray-400">Location:</span> <span class="text-white">${userInfo.location.city}, ${userInfo.location.state}</span></p>
                        <p><span class="text-gray-400">Address:</span> <span class="text-white">${userInfo.location.address}</span></p>
                        <p><span class="text-gray-400">Coordinates:</span> <span class="text-white font-mono">${userInfo.location.coordinates.lat}, ${userInfo.location.coordinates.lon}</span></p>
                    </div>
                </div>
                
                <!-- Device Information -->
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white mb-3">📱 Device Information</h4>
                    <div class="space-y-2 text-sm">
                        <p><span class="text-gray-400">Device Type:</span> <span class="text-white">${userInfo.device.type}</span></p>
                        <p><span class="text-gray-400">Operating System:</span> <span class="text-white">${userInfo.device.os}</span></p>
                        <p><span class="text-gray-400">Browser:</span> <span class="text-white">${userInfo.device.browser}</span></p>
                        <p><span class="text-gray-400">User Agent:</span> <span class="text-white text-xs break-all">${userInfo.device.userAgent}</span></p>
                    </div>
                </div>
                
                <!-- Account Statistics -->
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white mb-3">📊 Account Statistics</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-400">${userInfo.accountInfo.followers.toLocaleString()}</p>
                            <p class="text-gray-400">Followers</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-green-400">${userInfo.accountInfo.following.toLocaleString()}</p>
                            <p class="text-gray-400">Following</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-yellow-400">${userInfo.accountInfo.posts.toLocaleString()}</p>
                            <p class="text-gray-400">Posts</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-purple-400">${Math.round((userInfo.accountInfo.followers / (userInfo.accountInfo.following + 1)) * 100) / 100}</p>
                            <p class="text-gray-400">F/F Ratio</p>
                        </div>
                    </div>
                </div>
                
                <!-- Risk Assessment -->
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white mb-3">⚠️ Risk Assessment</h4>
                    ${riskIndicators.length > 0 ? `
                        <div class="space-y-2">
                            ${riskIndicators.map(indicator => `
                                <div class="bg-red-900/30 border border-red-500/50 rounded-lg p-2">
                                    <p class="text-red-400 text-sm">${indicator}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="bg-green-900/30 border border-green-500/50 rounded-lg p-3">
                            <p class="text-green-400 text-sm">✅ No immediate risk indicators detected</p>
                        </div>
                    `}
                </div>
            `;
            
            // Update map with location
            const mapDiv = document.getElementById('userLocationMap');
            mapDiv.innerHTML = `
                <div class="w-full h-full bg-gradient-to-br from-blue-900 to-purple-900 rounded-lg flex flex-col items-center justify-center">
                    <div class="text-center">
                        <div class="text-4xl mb-2">📍</div>
                        <h5 class="text-white font-bold">${userInfo.location.city}, ${userInfo.location.state}</h5>
                        <p class="text-gray-300 text-sm">Lat: ${userInfo.location.coordinates.lat}, Lon: ${userInfo.location.coordinates.lon}</p>
                        <p class="text-blue-400 text-xs mt-2">Interactive map integration available</p>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <p>🌐 IP: ${userInfo.connection.ipAddress} | 📶 ${userInfo.networkProvider}</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closeUserInfo() {
            const modal = document.getElementById('userInfoModal');
            modal.classList.add('hidden');
        }
        
        // Post Action Functions
        function reportPost(postId) {
            const userInfo = userProfiles.get(postId);
            if (!userInfo) return;
            
            const reportData = {
                postId: postId,
                username: userInfo.username,
                platform: userInfo.platform,
                timestamp: new Date().toISOString(),
                userInfo: userInfo,
                reportedBy: 'Aatra AI - AICMS',
                priority: 'HIGH'
            };
            
            // Create comprehensive report
            const reportContent = `
🚨 CYBERSECURITY THREAT REPORT - AATRA AI AICMS
=============================================

SUSPECT INFORMATION:
📱 Username: ${userInfo.username}
👤 Real Name: ${userInfo.realName}
🌐 Platform: ${userInfo.platform}
📍 Location: ${userInfo.location.city}, ${userInfo.location.state}
🏠 Address: ${userInfo.location.address}
🌍 Coordinates: ${userInfo.location.coordinates.lat}, ${userInfo.location.coordinates.lon}

NETWORK INTELLIGENCE:
📡 IP Address: ${userInfo.connection.ipAddress}
🏢 ISP: ${userInfo.connection.isp}
📶 Network Provider: ${userInfo.networkProvider}
📱 Connection Type: ${userInfo.connection.connectionType}

DEVICE INFORMATION:
💻 Device Type: ${userInfo.device.type}
🔧 Operating System: ${userInfo.device.os}
🌐 Browser: ${userInfo.device.browser}
📋 User Agent: ${userInfo.device.userAgent}

RISK ASSESSMENT:
${userInfo.riskProfile.suspiciousActivity ? '🚨 SUSPICIOUS ACTIVITY DETECTED' : '✅ No suspicious activity'}
${userInfo.riskProfile.multipleAccounts ? '⚠️ MULTIPLE ACCOUNTS DETECTED' : ''}
${userInfo.riskProfile.vpnUsage ? '🔒 VPN USAGE DETECTED' : ''}
${userInfo.riskProfile.botLikeBehavior ? '🤖 BOT-LIKE BEHAVIOR DETECTED' : ''}

ACCOUNT STATISTICS:
👥 Followers: ${userInfo.accountInfo.followers.toLocaleString()}
➡️ Following: ${userInfo.accountInfo.following.toLocaleString()}
📝 Posts: ${userInfo.accountInfo.posts.toLocaleString()}
📅 Account Age: ${userInfo.accountInfo.joinDate.toLocaleDateString()}

RECOMMENDATION: ${userInfo.riskProfile.suspiciousActivity || userInfo.riskProfile.multipleAccounts ? 'IMMEDIATE INVESTIGATION REQUIRED' : 'MONITOR FOR ESCALATION'}

Generated by: Aatra AI - Anti-India Campaign Monitoring System
Report Time: ${new Date().toLocaleString()}
Post ID: ${postId}
            `.trim();
            
            // Copy to clipboard
            navigator.clipboard.writeText(reportContent).then(() => {
                showNotification('📋 Report copied to clipboard! Ready to submit to cybercrime.gov.in', 'success');
            });
            
            // Open cybercrime portal
            setTimeout(() => {
                window.open('https://cybercrime.gov.in/Webform/report_abuse_social_media.aspx', '_blank');
            }, 1000);
            
            showNotification('🚨 Report generated! Opening cybercrime.gov.in portal...', 'warning');
        }
        
        function addToWatchlist(postId) {
            const userInfo = userProfiles.get(postId);
            if (!userInfo) return;
            
            showNotification(`👁️ ${userInfo.username} added to monitoring watchlist`, 'info');
            console.log('Added to watchlist:', userInfo);
        }
        
        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 text-white rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50`;
            
            const colors = {
                'info': 'bg-blue-600',
                'success': 'bg-green-600',
                'error': 'bg-red-600',
                'warning': 'bg-yellow-600'
            };
            
            notification.className += ` ${colors[type] || colors.info}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
            
        // User information generation for social simulation
        function generateUserInfo(username, platform) {
                const networkProviders = ['Jio', 'Airtel', 'VI', 'BSNL', 'Idea'];
                const cities = [
                    { name: 'Mumbai', state: 'Maharashtra', lat: 19.0760, lon: 72.8777, ip: '103.21.58' },
                    { name: 'Delhi', state: 'Delhi', lat: 28.7041, lon: 77.1025, ip: '103.25.41' },
                    { name: 'Bangalore', state: 'Karnataka', lat: 12.9716, lon: 77.5946, ip: '103.24.72' },
                    { name: 'Hyderabad', state: 'Telangana', lat: 17.3850, lon: 78.4867, ip: '103.23.81' },
                    { name: 'Chennai', state: 'Tamil Nadu', lat: 13.0827, lon: 80.2707, ip: '103.22.95' },
                    { name: 'Kolkata', state: 'West Bengal', lat: 22.5726, lon: 88.3639, ip: '103.26.14' },
                    { name: 'Pune', state: 'Maharashtra', lat: 18.5204, lon: 73.8567, ip: '103.28.37' },
                    { name: 'Ahmedabad', state: 'Gujarat', lat: 23.0225, lon: 72.5714, ip: '103.27.62' },
                    { name: 'Jaipur', state: 'Rajasthan', lat: 26.9124, lon: 75.7873, ip: '103.29.83' },
                    { name: 'Surat', state: 'Gujarat', lat: 21.1702, lon: 72.8311, ip: '103.30.45' }
                ];
                
                const city = cities[Math.floor(Math.random() * cities.length)];
                const provider = networkProviders[Math.floor(Math.random() * networkProviders.length)];
                const deviceTypes = ['Mobile', 'Desktop', 'Tablet'];
                const browsers = ['Chrome', 'Firefox', 'Safari', 'Edge'];
                
                return {
                    username: username,
                    realName: generateRealisticName(),
                    platform: platform,
                    networkProvider: provider,
                    location: {
                        city: city.name,
                        state: city.state,
                        coordinates: { lat: city.lat, lon: city.lon },
                        address: generateAddress(city.name, city.state)
                    },
                    connection: {
                        ipAddress: `${city.ip}.${Math.floor(Math.random() * 255)}`,
                        isp: provider + ' Networks Limited',
                        connectionType: Math.random() > 0.3 ? '4G' : '5G',
                        signalStrength: Math.floor(Math.random() * 100) + '%'
                    },
                    device: {
                        type: deviceTypes[Math.floor(Math.random() * deviceTypes.length)],
                        os: Math.random() > 0.5 ? 'Android' : 'iOS',
                        browser: browsers[Math.floor(Math.random() * browsers.length)],
                        userAgent: generateUserAgent()
                    },
                    accountInfo: {
                        joinDate: generateRandomDate(),
                        followers: Math.floor(Math.random() * 10000),
                        following: Math.floor(Math.random() * 1000),
                        posts: Math.floor(Math.random() * 5000),
                        verified: Math.random() > 0.8
                    },
                    riskProfile: {
                        suspiciousActivity: Math.random() > 0.7,
                        multipleAccounts: Math.random() > 0.85,
                        vpnUsage: Math.random() > 0.9,
                        botLikeBehavior: Math.random() > 0.8
                    }
                };
            }
            
            function generateRealisticName() {
                const firstNames = ['Rahul', 'Priya', 'Amit', 'Sneha', 'Vikram', 'Anita', 'Suresh', 'Kavya', 'Arjun', 'Meera'];
                const lastNames = ['Sharma', 'Patel', 'Singh', 'Kumar', 'Gupta', 'Reddy', 'Nair', 'Joshi', 'Shah', 'Verma'];
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                return `${firstName} ${lastName}`;
            }
            
            function generateAddress(city, state) {
                const streets = ['MG Road', 'Brigade Road', 'Park Street', 'Commercial Street', 'FC Road'];
                const areas = ['Sector 21', 'Block A', 'Phase 2', 'Extension', 'Colony'];
                return `${Math.floor(Math.random() * 999) + 1}, ${streets[Math.floor(Math.random() * streets.length)]}, ${areas[Math.floor(Math.random() * areas.length)]}, ${city}, ${state}`;
            }
            
            function generateUserAgent() {
                return 'Mozilla/5.0 (Linux; Android 12) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36';
            }
            
            function generateRandomDate() {
                const start = new Date(2018, 0, 1);
                const end = new Date(2023, 11, 31);
                return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
            }
            
            // --- START OF DOM CONTENT LOADED EVENT ---
            document.addEventListener('DOMContentLoaded', function() {
            let dashboardStats = {};
            let platformAnalytics = [];
            let aiMetrics = {};

            // --- ELEMENT SELECTORS ---
            const threatList = document.getElementById('threat-list');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const navLinks = document.querySelectorAll('.nav-link');
            const pageSections = document.querySelectorAll('.page-section');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const textContent = document.getElementById('textContent');
            const urlInput = document.getElementById('urlInput');
            const analysisResult = document.getElementById('analysisResult');
            const summarizeBtn = document.getElementById('summarizeBtn');
            const summaryResult = document.getElementById('summaryResult');
            
            // Modal elements
            const reportModal = document.getElementById('reportModal');
            const closeModal = document.getElementById('closeModal');
            const cancelReport = document.getElementById('cancelReport');
            const submitReport = document.getElementById('submitReport');
            const selectedThreatInfo = document.getElementById('selectedThreatInfo');
            const additionalDetails = document.getElementById('additionalDetails');
            const reporterContact = document.getElementById('reporterContact');
            const urgentReport = document.getElementById('urgentReport');
            
            let currentSelectedThreat = null;

            // --- BACKEND API FUNCTIONS ---
            async function callBackendAPI(endpoint, method = 'GET', data = null) {
                try {
                    const options = {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    };
                    
                    if (data) {
                        options.body = JSON.stringify(data);
                    }
                    
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error(`API call failed: ${endpoint}`, error);
                    throw error;
                }
            }

            // Load dashboard statistics
            async function loadDashboardStats() {
                try {
                    dashboardStats = await callBackendAPI('/dashboard/stats');
                    updateDashboardUI();
                } catch (error) {
                    console.error('Failed to load dashboard stats:', error);
                    // Fallback to demo data
                    dashboardStats = {
                        threatsDetected: 216,
                        threatsDetectedChange: '+9 from last hour',
                        threatsBlocked: 101,
                        threatsBlockedChange: '+6 from last hour',
                        systemLoad: '30.5%',
                        systemLoadChange: '+2.0% from last hour',
                        uptime: '99.85%',
                        uptimeChange: '+0.0% from last hour'
                    };
                    updateDashboardUI();
                }
            }

            // Load live threats
            async function loadLiveThreats(filter = 'all') {
                try {
                    const response = await callBackendAPI(`/dashboard/threats/live?filter_type=${filter}`);
                    threatsData = response.threats;
                    updateTabCounts(response.counts);
                    renderThreats(filter);
                } catch (error) {
                    console.error('Failed to load threats:', error);
                    // Fallback to demo data
                    threatsData = [
                        { id: 1, title: 'Demo: Backend Connection Failed', region: 'System', confidence: 0, type: 'low', time: new Date().toLocaleTimeString(), platform: 'System', description: 'Unable to connect to backend API. Please check if the backend server is running.' }
                    ];
                    renderThreats(filter);
                }
            }

            // Load platform analytics
            async function loadPlatformAnalytics() {
                try {
                    const response = await callBackendAPI('/dashboard/platforms/analytics');
                    platformAnalytics = response.platforms;
                    updatePlatformAnalyticsUI();
                } catch (error) {
                    console.error('Failed to load platform analytics:', error);
                }
            }

            // Load AI metrics
            async function loadAIMetrics() {
                try {
                    aiMetrics = await callBackendAPI('/dashboard/ai-metrics');
                    updateAIMetricsUI();
                } catch (error) {
                    console.error('Failed to load AI metrics:', error);
                }
            }

            // Update dashboard stats UI
            function updateDashboardUI() {
                document.getElementById('threatsDetected').textContent = dashboardStats.threatsDetected || '0';
                document.getElementById('threatsDetectedChange').textContent = dashboardStats.threatsDetectedChange || '+0 from last hour';
                document.getElementById('threatsBlocked').textContent = dashboardStats.threatsBlocked || '0';
                document.getElementById('threatsBlockedChange').textContent = dashboardStats.threatsBlockedChange || '+0 from last hour';
                document.getElementById('systemLoad').textContent = dashboardStats.systemLoad || '0%';
                document.getElementById('systemLoadChange').textContent = dashboardStats.systemLoadChange || '+0% from last hour';
                document.getElementById('uptime').textContent = dashboardStats.uptime || '99%';
                document.getElementById('uptimeChange').textContent = dashboardStats.uptimeChange || '+0% from last hour';
            }

            // Update tab counts
            function updateTabCounts(counts) {
                const tabBtns = document.querySelectorAll('.tab-btn');
                tabBtns.forEach(btn => {
                    const filter = btn.getAttribute('data-filter');
                    const count = counts[filter] || 0;
                    if (filter === 'all') {
                        btn.textContent = `All (${count})`;
                    } else {
                        btn.textContent = `${filter.charAt(0).toUpperCase() + filter.slice(1)} (${count})`;
                    }
                });
            }

            // Update platform analytics UI
            function updatePlatformAnalyticsUI() {
                // Update total campaigns count
                const totalCampaigns = platformAnalytics.reduce((sum, platform) => sum + platform.campaigns, 0);
                const campaignCountElement = document.querySelector('.text-xs.bg-gray-700');
                if (campaignCountElement) {
                    campaignCountElement.textContent = `${totalCampaigns} CAMPAIGNS`;
                }
            }

            // Update AI metrics UI
            function updateAIMetricsUI() {
                const verifiedElement = document.getElementById('verifiedCampaigns');
                const falsePositivesElement = document.getElementById('falsePositives');
                const totalReportsElement = document.getElementById('totalReports');
                const accuracyElement = document.getElementById('aiAccuracy');
                
                if (verifiedElement) verifiedElement.textContent = aiMetrics.verifiedCampaigns || '0';
                if (falsePositivesElement) falsePositivesElement.textContent = aiMetrics.falsePositives || '0';
                if (totalReportsElement) totalReportsElement.textContent = aiMetrics.totalReports || '0';
                if (accuracyElement) accuracyElement.textContent = `${aiMetrics.accuracyRate || '0'}%`;
            }
            
            async function analyzeContentWithBackend(content) {
                analysisResult.innerHTML = '<div class="flex flex-col items-center gap-2"><span class="loader"></span><p>AI is analyzing...</p></div>';
                
                try {
                    const result = await callBackendAPI('/analysis/content', 'POST', {
                        content: content,
                        platform: 'manual_analysis'
                    });
                    
                    const data = result;
                
                    let borderColor, textColor, shieldSVG;
                    switch(data.riskLevel.toLowerCase()){
                        case 'critical risk':
                            borderColor = 'border-red-500/50'; textColor = 'text-red-400';
                            shieldSVG = `<svg class="w-6 h-6 mr-2 ${textColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>`;
                            break;
                        case 'high risk':
                            borderColor = 'border-yellow-500/50'; textColor = 'text-yellow-400';
                             shieldSVG = `<svg class="w-6 h-6 mr-2 ${textColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>`;
                            break;
                        case 'moderate risk':
                             borderColor = 'border-blue-500/50'; textColor = 'text-blue-400';
                             shieldSVG = `<svg class="w-6 h-6 mr-2 ${textColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>`;
                            break;
                        default: // Low Risk
                            borderColor = 'border-green-500/50'; textColor = 'text-green-400';
                             shieldSVG = `<svg class="w-6 h-6 mr-2 ${textColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>`;
                            break;
                    }
                    
                    const indicatorsHtml = data.indicators.map(indicator => `
                        <div class="bg-gray-800/60 p-2.5 rounded-md text-sm flex items-center">
                           <span class="text-blue-400 mr-2">●</span> ${indicator}
                        </div>
                    `).join('');

                    const resultHtml = `
                        <div class="space-y-4 text-left w-full">
                            <div class="p-4 rounded-lg bg-gray-800/50 border ${borderColor}">
                                <div class="flex items-center">
                                    ${shieldSVG}
                                    <div>
                                        <h4 class="font-bold ${textColor}">${data.riskLevel} Content</h4>
                                        <p class="text-xs text-gray-400">Confidence: ${data.confidence}%</p>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5 my-2"><div class="${textColor.replace('text','bg')} h-1.5 rounded-full" style="width: ${data.confidence}%"></div></div>
                                <p class="text-sm text-gray-300">${data.summary}</p>
                            </div>
                            
                            <div>
                                <h5 class="text-gray-400 text-sm font-semibold mb-2">Detected Indicators</h5>
                                <div class="space-y-2">${indicatorsHtml}</div>
                            </div>

                            <div>
                                <h5 class="text-gray-400 text-sm font-semibold mb-2">Recommended Action</h5>
                                <div class="bg-red-900/40 border border-red-500/30 p-3 rounded-md">
                                    <p class="text-sm text-red-300">${data.recommendedAction}</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center text-xs text-gray-500 pt-2">
                                <span>Analysis Time: ${new Date().toLocaleTimeString()}</span>
                                <span>Model Version: v2.4.1 (Aatra AI Backend)</span>
                            </div>
                        </div>`;
                    analysisResult.innerHTML = resultHtml;

                } catch (error) {
                    console.error("Failed to analyze content:", error);
                    analysisResult.innerHTML = `<p class="text-red-400">Error: Unable to analyze content. Please ensure the backend server is running and try again.</p>`;
                }
            }

            async function analyzeUrlWithGemini(url) {
                analysisResult.innerHTML = '<div class="flex flex-col items-center gap-2"><span class="loader"></span><p>Fetching URL content and analyzing with Gemini AI...</p></div>';
                
                try {
                    // Clean and validate URL
                    let cleanUrl = url.trim();
                    if (!cleanUrl.startsWith('http://') && !cleanUrl.startsWith('https://')) {
                        cleanUrl = 'https://' + cleanUrl;
                    }
                    
                    // Fetch content using a simple proxy approach (cors-anywhere or similar)
                    let pageContent = '';
                    try {
                        // Try to fetch the URL directly (this may fail due to CORS)
                        const response = await fetch(cleanUrl);
                        if (response.ok) {
                            pageContent = await response.text();
                        } else {
                            throw new Error('Direct fetch failed');
                        }
                    } catch (e) {
                        // Fallback: Use the URL as context for Gemini analysis
                        pageContent = `URL to analyze: ${cleanUrl}`;
                    }
                    
                    // Extract text content from HTML if we got HTML
                    let textContent = pageContent;
                    if (pageContent.includes('<html') || pageContent.includes('<body')) {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(pageContent, 'text/html');
                        
                        // Remove script and style elements
                        const scripts = doc.querySelectorAll('script, style');
                        scripts.forEach(el => el.remove());
                        
                        // Get text content
                        textContent = doc.body ? doc.body.innerText : doc.textContent || pageContent;
                    }
                    
                    // Limit content length
                    if (textContent.length > 3000) {
                        textContent = textContent.substring(0, 3000) + '...';
                    }
                    
                    // If we couldn't get meaningful content, analyze the URL structure itself
                    if (!textContent || textContent.length < 50) {
                        textContent = `Analyze this URL for potential anti-India content or threats: ${cleanUrl}. Look for suspicious patterns in the domain name, path, or any visible content.`;
                    }
                    
                    // Analyze with Gemini using the existing analyzeContentWithGemini function
                    const prompt = `Analyze this web content for anti-India hate speech, disinformation, or threats. URL: ${cleanUrl}

Content: ${textContent}

Please provide a detailed analysis focusing on:
1. Any anti-India sentiment or hate speech
2. Disinformation or propaganda patterns
3. Threat level assessment
4. Specific concerning phrases or content
5. Recommended actions

Format your response as a structured analysis.`;

                    const result = await analyzeContentWithGemini(prompt);
                    
                    // Enhanced display for URL analysis
                    const urlAnalysisHtml = `
                        <div class="space-y-4 text-left w-full">
                            <div class="p-4 rounded-lg bg-gradient-to-r from-blue-900/50 to-purple-900/50 border border-blue-500/50">
                                <div class="flex items-center mb-2">
                                    <svg class="w-6 h-6 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                    </svg>
                                    <h4 class="font-bold text-blue-400">🌐 URL Content Analysis</h4>
                                </div>
                                <div class="mt-2 p-2 bg-gray-700/50 rounded text-xs">
                                    <p class="text-gray-400 mb-1">Source URL:</p>
                                    <p class="text-blue-400 break-all">${cleanUrl}</p>
                                </div>
                                <div class="mt-2 p-2 bg-gray-700/50 rounded text-xs">
                                    <p class="text-gray-400 mb-1">Content Length:</p>
                                    <p class="text-green-400">${textContent.length} characters analyzed</p>
                                </div>
                            </div>
                            
                            <div class="p-4 rounded-lg bg-gray-800/50 border border-gray-600">
                                <h5 class="text-gray-400 text-sm font-semibold mb-3">🤖 Gemini AI Analysis Results</h5>
                                <div class="text-sm text-gray-300 space-y-2">${result.replace(/\n/g, '<br>')}</div>
                            </div>
                            
                            <div class="flex justify-between items-center text-xs text-gray-500 pt-2">
                                <span>Analysis Time: ${new Date().toLocaleTimeString()}</span>
                                <span>Gemini AI • URL Content Analysis</span>
                            </div>
                        </div>`;
                    
                    analysisResult.innerHTML = urlAnalysisHtml;

                } catch (error) {
                    console.error('URL analysis error:', error);
                    analysisResult.innerHTML = `
                        <div class="p-4 rounded-lg bg-red-900/50 border border-red-500/50">
                            <h4 class="text-lg font-semibold text-red-400 mb-2">🚨 URL Analysis Error</h4>
                            <p class="text-gray-300 mb-2">Unable to analyze the URL. This could be due to:</p>
                            <ul class="text-sm text-gray-400 list-disc list-inside space-y-1">
                                <li>CORS restrictions preventing direct access</li>
                                <li>Invalid or inaccessible URL</li>
                                <li>Network connectivity issues</li>
                                <li>Gemini API limitations</li>
                            </ul>
                            <p class="text-sm text-yellow-400 mt-3">💡 Try copying the content manually and using text analysis instead.</p>
                            <p class="text-xs text-gray-500 mt-2">Error: ${error.message}</p>
                        </div>
                    `;
                }
            }

            async function summarizeAlertsWithBackend() {
                summaryResult.classList.remove('hidden');
                summaryResult.innerHTML = '<div class="flex items-center gap-2"><span class="loader" style="width:24px; height:24px; border-width: 3px;"></span><p>AI is generating a summary...</p></div>';

                try {
                    const result = await callBackendAPI('/dashboard/threats/summarize', 'POST');
                    summaryResult.innerHTML = result.summary;
                } catch (error) {
                    console.error('Failed to generate summary:', error);
                    summaryResult.innerHTML = 'Unable to generate summary. Backend connection may be unavailable.';
                }
            }

            // --- REPORTING FUNCTIONS ---
            function openReportModal(threat) {
                currentSelectedThreat = threat;
                
                // Populate threat information
                selectedThreatInfo.innerHTML = `
                    <div class="space-y-2">
                        <h4 class="font-bold text-white">${threat.title}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <p><span class="text-gray-400">Platform:</span> ${threat.platform}</p>
                            <p><span class="text-gray-400">Region:</span> ${threat.region}</p>
                            <p><span class="text-gray-400">Confidence:</span> ${threat.confidence}%</p>
                            <p><span class="text-gray-400">Detected:</span> ${threat.time}</p>
                        </div>
                        <p class="text-sm text-gray-300 mt-2">${threat.description}</p>
                    </div>
                `;
                
                reportModal.classList.remove('hidden');
            }

            function closeReportModal() {
                reportModal.classList.add('hidden');
                currentSelectedThreat = null;
                additionalDetails.value = '';
                reporterContact.value = '';
                urgentReport.checked = false;
            }

            function submitThreatReport() {
                if (!currentSelectedThreat) return;

                const reportData = {
                    threat: currentSelectedThreat,
                    additionalDetails: additionalDetails.value,
                    reporterContact: reporterContact.value,
                    urgent: urgentReport.checked,
                    timestamp: new Date().toISOString(),
                    source: 'Astra AI - AICMS'
                };

                // Create report content
                const reportContent = `
CYBERCRIME REPORT - Astra AI AICMS
=====================================

THREAT DETAILS:
Title: ${reportData.threat.title}
Platform: ${reportData.threat.platform}
Region: ${reportData.threat.region}
Confidence Level: ${reportData.threat.confidence}%
Detection Time: ${reportData.threat.time}
Threat Type: ${reportData.threat.type.toUpperCase()}

DESCRIPTION:
${reportData.threat.description}

ADDITIONAL DETAILS:
${reportData.additionalDetails || 'None provided'}

PRIORITY: ${reportData.urgent ? 'URGENT' : 'Normal'}
REPORTED BY: ${reportData.reporterContact || 'Anonymous'}
REPORT TIME: ${new Date().toLocaleString()}
SOURCE SYSTEM: Astra AI - Anti-India Campaign Monitoring System (AICMS)

Note: This report was automatically generated by Astra AI's cybersecurity monitoring system. 
Please investigate the above-mentioned threat and take appropriate action.
                `.trim();

                // Open cybercrime.gov.in in a new tab with pre-filled data
                const cybercrimeUrl = 'https://cybercrime.gov.in/Webform/report_abuse_social_media.aspx';
                const newWindow = window.open(cybercrimeUrl, '_blank');
                
                // Copy report to clipboard for easy pasting
                navigator.clipboard.writeText(reportContent).then(() => {
                    console.log('Report content copied to clipboard');
                });

                // Show success message
                selectedThreatInfo.innerHTML = `
                    <div class="bg-green-900/40 border border-green-500/30 p-4 rounded-lg">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h4 class="font-bold text-green-400">Report Prepared</h4>
                        </div>
                        <p class="text-sm text-green-300">
                            • Cybercrime portal opened in new tab<br>
                            • Report details copied to clipboard<br>
                            • Please paste the report content when filing your complaint
                        </p>
                    </div>
                `;

                // Update button to show completion
                submitReport.innerHTML = '✅ Redirected to Cybercrime Portal';
                submitReport.disabled = true;
                submitReport.classList.add('bg-green-600');

                // Auto-close modal after 3 seconds
                setTimeout(() => {
                    closeReportModal();
                    submitReport.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        Report to Cybercrime.gov.in
                    `;
                    submitReport.disabled = false;
                    submitReport.classList.remove('bg-green-600');
                }, 3000);
            }

            // --- UI LOGIC ---
            function renderThreats(filter = 'all') {
                threatList.innerHTML = '';
                const filteredThreats = threatsData.filter(threat => filter === 'all' || threat.type === filter);
                
                if (filteredThreats.length === 0) {
                    threatList.innerHTML = '<p class="text-gray-500 text-center">No threats match this category.</p>';
                    return;
                }

                filteredThreats.forEach(threat => {
                    let typeColorClass, typeBgColorClass;
                    switch (threat.type) {
                        case 'critical':
                            typeColorClass = 'text-red-400';
                            typeBgColorClass = 'bg-red-500/10';
                            break;
                        case 'high':
                            typeColorClass = 'text-yellow-400';
                            typeBgColorClass = 'bg-yellow-500/10';
                            break;
                        case 'low':
                            typeColorClass = 'text-green-400';
                            typeBgColorClass = 'bg-green-500/10';
                            break;
                        default:
                            typeColorClass = 'text-gray-400';
                            typeBgColorClass = 'bg-gray-500/10';
                    }

                    const threatElement = document.createElement('div');
                    threatElement.className = `threat-item flex items-center justify-between p-3 rounded-lg ${typeBgColorClass} cursor-pointer animate-fade-in`;
                    threatElement.innerHTML = `
                        <div class="flex-1">
                            <p class="font-semibold text-white">${threat.title}</p>
                            <p class="text-sm text-gray-400">${threat.platform} • ${threat.region} • ${threat.time}</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="text-right">
                                <span class="font-bold ${typeColorClass}">${threat.type.toUpperCase()}</span>
                                <p class="text-xs text-gray-500">Confidence: ${threat.confidence}%</p>
                            </div>
                            <button class="report-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-3 rounded transition duration-300" data-threat-id="${threat.id}">
                                Report
                            </button>
                        </div>
                    `;
                    
                    // Add click event for reporting
                    const reportBtn = threatElement.querySelector('.report-btn');
                    reportBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openReportModal(threat);
                    });
                    
                    threatList.appendChild(threatElement);
                });
            }

            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleString('en-US', { timeStyle: 'medium' });
                document.getElementById('currentTime').innerHTML = `${timeString}<br>THREAT LEVEL: <span class="text-yellow-400 font-bold">ELEVATED</span>`;
                document.getElementById('lastUpdate').textContent = `Last update: ${now.toLocaleTimeString()}`;
            }

            // --- EVENT LISTENERS ---
            
            // Modal event listeners
            closeModal.addEventListener('click', closeReportModal);
            cancelReport.addEventListener('click', closeReportModal);
            submitReport.addEventListener('click', submitThreatReport);
            
            // Close modal when clicking backdrop
            reportModal.addEventListener('click', (e) => {
                if (e.target === reportModal) {
                    closeReportModal();
                }
            });

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => b.classList.remove('active-tab'));
                    btn.classList.add('active-tab');
                    loadLiveThreats(btn.dataset.filter);
                });
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);

                    navLinks.forEach(l => l.classList.remove('active-link'));
                    link.classList.add('active-link');

                    pageSections.forEach(section => {
                        if (section.id === targetId) {
                            section.classList.remove('hidden');
                        } else {
                            section.classList.add('hidden');
                        }
                    });
                });
            });

            analyzeBtn.addEventListener('click', () => {
                const textValue = textContent.value.trim();
                const urlValue = urlInput.value.trim();
                
                if (urlValue && textValue) {
                    analysisResult.innerHTML = '<p class="text-yellow-400">Please choose either URL analysis OR text analysis, not both.</p>';
                } else if (urlValue) {
                    // Check if it looks like a URL
                    const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
                    if (urlPattern.test(urlValue) || urlValue.includes('.')) {
                        analyzeUrlWithGemini(urlValue);
                    } else {
                        analysisResult.innerHTML = '<p class="text-yellow-400">Please enter a valid URL (e.g., example.com or https://example.com)</p>';
                    }
                } else if (textValue) {
                    analyzeContentWithBackend(textValue);
                } else {
                    analysisResult.innerHTML = '<p class="text-yellow-400">Please enter a URL or some text to analyze.</p>';
                }
            });

            summarizeBtn.addEventListener('click', summarizeAlertsWithBackend);

            // --- INITIALIZATION ---
            // Load initial data from backend
            async function initializeApp() {
                await loadDashboardStats();
                await loadLiveThreats('all');
                await loadPlatformAnalytics();
                await loadAIMetrics();
                updateTime();
            }
            
            // Initialize app
            initializeApp();
            
            // Set up periodic updates
            setInterval(updateTime, 1000);
            setInterval(() => {
                loadDashboardStats();
                loadLiveThreats('all');
                loadPlatformAnalytics();
            }, 60000); // Update every minute
            
            // --- SOCIAL MEDIA SIMULATION FUNCTIONS ---
            let socialSimStats = {
                postsAnalyzed: 0,
                threatsDetected: 0,
                totalAnalysisTime: 0
            };
            
            // Sample content for quick fill buttons
            const sampleContent = {
                critical: [
                    "I hate India and want to destroy everything Indian. Pakistan zindabad! Death to Indian democracy!",
                    "Khalistan zindabad! Free Kashmir from terrorist Indian army. Break India into pieces!",
                    "Indian government are terrorists. Death to all Indians. Destroy Hinduism completely!"
                ],
                high: [
                    "Indian culture is backward and primitive. Boycott all Indian festivals and traditions.",
                    "India's economy is fake. All Indian GDP numbers are lies. Boycott Indian products.",
                    "Indian army kills innocent people. India is a terrorist nation spreading violence."
                ],
                safe: [
                    "I love India and its rich cultural heritage. Proud to be Indian! Jai Hind!",
                    "India has made great progress in technology and space exploration. ISRO achievements are amazing!",
                    "Beautiful Indian festivals and traditions are wonderful to experience and learn about."
                ]
            };
            
            // Initialize social simulation when page loads
            function initializeSocialSimulation() {
                const postContent = document.getElementById('postContent');
                const charCount = document.getElementById('charCount');
                const quickFillCritical = document.getElementById('quickFillCritical');
                const quickFillHigh = document.getElementById('quickFillHigh');
                const quickFillSafe = document.getElementById('quickFillSafe');
                const publishPost = document.getElementById('publishPost');
                const mediaUploadBtn = document.getElementById('mediaUploadBtn');
                const mediaUpload = document.getElementById('mediaUpload');
                
                if (!postContent) return; // Not on social simulation page
                
                // Character counter
                postContent.addEventListener('input', function() {
                    const count = this.value.length;
                    charCount.textContent = `${count}/280`;
                    charCount.className = count > 250 ? 'text-xs text-red-400' : 'text-xs text-gray-400';
                });
                
                // Quick fill buttons
                quickFillCritical.addEventListener('click', () => {
                    const content = sampleContent.critical[Math.floor(Math.random() * sampleContent.critical.length)];
                    postContent.value = content;
                    postContent.dispatchEvent(new Event('input'));
                });
                
                quickFillHigh.addEventListener('click', () => {
                    const content = sampleContent.high[Math.floor(Math.random() * sampleContent.high.length)];
                    postContent.value = content;
                    postContent.dispatchEvent(new Event('input'));
                });
                
                quickFillSafe.addEventListener('click', () => {
                    const content = sampleContent.safe[Math.floor(Math.random() * sampleContent.safe.length)];
                    postContent.value = content;
                    postContent.dispatchEvent(new Event('input'));
                });
                
                // Media upload simulation
                mediaUploadBtn.addEventListener('click', () => {
                    mediaUpload.click();
                });
                
                mediaUpload.addEventListener('change', async function(e) {
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        mediaUploadBtn.textContent = `Selected: ${file.name}`;
                        mediaUploadBtn.className = 'mt-2 bg-blue-600 hover:bg-blue-700 text-white text-xs px-4 py-2 rounded';
                        
                        // Auto-analyze multimedia content
                        await analyzeMultimedia(file);
                    }
                });
                
                // Publish post
                publishPost.addEventListener('click', async () => {
                    await publishSocialPost();
                });
            }
            
            // Publish and analyze social media post
            async function publishSocialPost() {
                const postContent = document.getElementById('postContent');
                const platformSelect = document.getElementById('platformSelect');
                const usernameInput = document.getElementById('usernameInput');
                const publishBtn = document.getElementById('publishPost');
                
                if (!postContent.value.trim()) {
                    alert('Please enter some content for your post!');
                    return;
                }
                
                // Show loading state
                publishBtn.disabled = true;
                publishBtn.innerHTML = `
                    <div class="loader w-5 h-5 mr-2"></div>
                    Analyzing...
                `;
                
                const startTime = performance.now();
                
                try {
                    // Analyze content using backend API
                    const analysisResult = await callBackendAPI('/analysis/content', 'POST', {
                        content: postContent.value,
                        platform: platformSelect.value,
                        source_type: 'social_simulation'
                    });
                    
                    const analysisTime = performance.now() - startTime;
                    
                    // Update statistics
                    socialSimStats.postsAnalyzed++;
                    socialSimStats.totalAnalysisTime += analysisTime;
                    
                    // Convert backend response format to expected format
                    const riskLevel = analysisResult.riskLevel || 'Low Risk';
                    if (riskLevel === 'Critical Risk' || riskLevel === 'High Risk') {
                        socialSimStats.threatsDetected++;
                    }
                    
                    // Generate user information and unique post ID
                    const userInfo = generateUserInfo(usernameInput.value || '@demouser', platformSelect.value);
                    const postId = `post_${++postCounter}`;
                    
                    // Store user profile globally
                    userProfiles.set(postId, userInfo);
                    
                    // Add post to social feed
                    addPostToFeed({
                        postId: postId,
                        username: usernameInput.value || '@demouser',
                        platform: platformSelect.value,
                        content: postContent.value,
                        analysisResult: analysisResult,
                        analysisTime: analysisTime,
                        timestamp: new Date(),
                        userInfo: userInfo
                    });
                    
                    // Update simulation statistics
                    updateSimulationStats();
                    
                    // Clear form
                    postContent.value = '';
                    document.getElementById('charCount').textContent = '0/280';
                    
                    // Reset media upload
                    const mediaUploadBtn = document.getElementById('mediaUploadBtn');
                    mediaUploadBtn.textContent = 'Choose File';
                    mediaUploadBtn.className = 'mt-2 bg-gray-700 hover:bg-gray-600 text-white text-xs px-4 py-2 rounded';
                    
                } catch (error) {
                    console.error('Failed to analyze post:', error);
                    // Generate user info even for failed posts
                    const userInfo = generateUserInfo(usernameInput.value || '@demouser', platformSelect.value);
                    const postId = `post_${++postCounter}`;
                    userProfiles.set(postId, userInfo);
                    
                    // Add post with error state
                    addPostToFeed({
                        postId: postId,
                        username: usernameInput.value || '@demouser',
                        platform: platformSelect.value,
                        content: postContent.value,
                        analysisResult: { error: 'Analysis failed - backend not available' },
                        analysisTime: performance.now() - startTime,
                        timestamp: new Date(),
                        userInfo: userInfo
                    });
                } finally {
                    // Reset publish button
                    publishBtn.disabled = false;
                    publishBtn.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        Publish Post & Analyze
                    `;
                }
            }
            
            // Add post to social feed
            function addPostToFeed(post) {
                const socialFeed = document.getElementById('socialFeed');
                
                // Clear empty state if this is first post
                if (socialSimStats.postsAnalyzed === 1) {
                    socialFeed.innerHTML = '';
                }
                
                const riskColors = {
                    critical: { bg: 'bg-red-900/30', border: 'border-red-500/50', text: 'text-red-400', badge: 'bg-red-500' },
                    high: { bg: 'bg-yellow-900/30', border: 'border-yellow-500/50', text: 'text-yellow-400', badge: 'bg-yellow-500' },
                    moderate: { bg: 'bg-orange-900/30', border: 'border-orange-500/50', text: 'text-orange-400', badge: 'bg-orange-500' },
                    low: { bg: 'bg-green-900/30', border: 'border-green-500/50', text: 'text-green-400', badge: 'bg-green-500' }
                };
                
                const platformIcons = {
                    twitter: '🐦', facebook: '📘', instagram: '📷', youtube: '📹', reddit: '📱', telegram: '✈️'
                };
                
                let riskLevel = 'low';
                let riskText = 'Safe Content';
                let confidence = '0%';
                let indicators = [];
                
                if (post.analysisResult.error) {
                    riskLevel = 'moderate';
                    riskText = 'Analysis Failed';
                    confidence = '--';
                } else {
                    // Convert backend response format to frontend format
                    const backendRiskLevel = post.analysisResult.riskLevel || 'Low Risk';
                    const riskMapping = {
                        'Critical Risk': 'critical',
                        'High Risk': 'high', 
                        'Moderate Risk': 'moderate',
                        'Low Risk': 'low'
                    };
                    
                    riskLevel = riskMapping[backendRiskLevel] || 'low';
                    confidence = `${post.analysisResult.confidence || 0}%`;
                    indicators = post.analysisResult.indicators || [];
                    
                    const riskLevelText = {
                        'critical': 'CRITICAL THREAT',
                        'high': 'HIGH RISK', 
                        'moderate': 'MODERATE RISK',
                        'low': 'SAFE CONTENT'
                    };
                    riskText = riskLevelText[riskLevel] || 'UNKNOWN';
                }
                
                const colors = riskColors[riskLevel] || riskColors.low;
                
                const postElement = document.createElement('div');
                postElement.className = `${colors.bg} border ${colors.border} rounded-lg p-4 transition-all duration-300 hover:scale-[1.02]`;
                
                postElement.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            ${post.username.charAt(1).toUpperCase()}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-semibold text-white text-sm cursor-pointer hover:text-blue-400" onclick="showUserInfoById('${post.postId}')">${post.username}</span>
                                <button onclick="showUserInfoById('${post.postId}')" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-2 py-1 rounded-full transition duration-300">👤 Info</button>
                                <span class="text-gray-400 text-xs">${platformIcons[post.platform]} ${post.platform}</span>
                                <span class="text-gray-500 text-xs">${post.timestamp.toLocaleTimeString()}</span>
                                <span class="ml-auto px-2 py-1 ${colors.badge} text-white text-xs rounded-full font-bold">
                                    LIVE
                                </span>
                            </div>
                            
                            <p class="text-gray-200 text-sm mb-3 break-words">${post.content}</p>
                            
                            <div class="bg-gray-900/50 rounded-lg p-3 mb-2">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-bold ${colors.text} text-sm">🛡️ ${riskText}</span>
                                    <span class="text-gray-400 text-xs">Confidence: ${confidence}</span>
                                </div>
                                
                                ${indicators.length > 0 ? `
                                    <div class="text-xs text-gray-400 mb-1">
                                        Detected indicators: ${indicators.join(', ')}
                                    </div>
                                ` : ''}
                                
                                <div class="flex justify-between items-center text-xs text-gray-500">
                                    <span>Analysis time: ${Math.round(post.analysisTime)}ms</span>
                                    <span>🔍 Real-time detection</span>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex space-x-2 mt-2">
                                <button onclick="showUserInfoById('${post.postId}')" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded-full transition duration-300">
                                    👤 View Profile
                                </button>
                                ${riskLevel === 'critical' || riskLevel === 'high' ? `
                                    <button onclick="reportPost('${post.postId}')" class="bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded-full transition duration-300">
                                        🚨 Report Threat
                                    </button>
                                ` : `
                                    <button onclick="reportPost('${post.postId}')" class="bg-yellow-600 hover:bg-yellow-700 text-white text-xs px-3 py-1 rounded-full transition duration-300">
                                        📝 Report Post
                                    </button>
                                `}
                                <button onclick="addToWatchlist('${post.postId}')" class="bg-purple-600 hover:bg-purple-700 text-white text-xs px-3 py-1 rounded-full transition duration-300">
                                    👁️ Monitor
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add to top of feed
                socialFeed.insertBefore(postElement, socialFeed.firstChild);
                
                // Remove oldest posts if more than 10
                while (socialFeed.children.length > 10) {
                    socialFeed.removeChild(socialFeed.lastChild);
                }
                
                // Animate in
                postElement.style.transform = 'translateY(-20px)';
                postElement.style.opacity = '0';
                setTimeout(() => {
                    postElement.style.transform = 'translateY(0)';
                    postElement.style.opacity = '1';
                }, 100);
            }
            
            // Update simulation statistics
            function updateSimulationStats() {
                document.getElementById('postsAnalyzed').textContent = socialSimStats.postsAnalyzed;
                document.getElementById('threatsDetectedSim').textContent = socialSimStats.threatsDetected;
                
                const avgTime = socialSimStats.postsAnalyzed > 0 
                    ? (socialSimStats.totalAnalysisTime / socialSimStats.postsAnalyzed / 1000).toFixed(1)
                    : '1.2';
                document.getElementById('analysisSpeed').textContent = `${avgTime}s`;
                
                // Update confidence based on last analysis
                const confidence = socialSimStats.postsAnalyzed > 0 ? 
                    `${Math.round(85 + Math.random() * 10)}%` : '--';
                document.getElementById('avgConfidence').textContent = confidence;
                
                // Update detection stats
                const detectionStats = document.getElementById('detectionStats');
                if (detectionStats) {
                    detectionStats.textContent = `${socialSimStats.postsAnalyzed} posts analyzed`;
                }
            }
            
            // Analyze multimedia content (images/videos)
            async function analyzeMultimedia(file) {
                const mediaUploadBtn = document.getElementById('mediaUploadBtn');
                const originalText = mediaUploadBtn.textContent;
                
                try {
                    // Show loading state
                    mediaUploadBtn.textContent = '🔍 Analyzing...';
                    mediaUploadBtn.className = 'mt-2 bg-yellow-600 text-white text-xs px-4 py-2 rounded';
                    
                    // Create FormData for file upload
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('platform', document.getElementById('platformSelect').value);
                    
                    const startTime = performance.now();
                    
                    // Call multimedia analysis API
                    const response = await fetch(`${API_BASE_URL}/analysis/multimedia`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const analysisResult = await response.json();
                    const analysisTime = performance.now() - startTime;
                    
                    // Show success state
                    mediaUploadBtn.textContent = '✅ Analysis Complete';
                    mediaUploadBtn.className = 'mt-2 bg-green-600 text-white text-xs px-4 py-2 rounded';
                    
                    // Add multimedia analysis result to feed
                    addMultimediaToFeed({
                        file: file,
                        analysisResult: analysisResult,
                        analysisTime: analysisTime,
                        timestamp: new Date()
                    });
                    
                    // If text was detected, populate the post content field
                    if (analysisResult.text_detected) {
                        const postContent = document.getElementById('postContent');
                        postContent.value = `[Multimedia Analysis] Detected text: "${analysisResult.text_detected}"`;
                        postContent.dispatchEvent(new Event('input'));
                        
                        // Show notification
                        showNotification(
                            `Text detected in ${file.type.startsWith('image/') ? 'image' : 'video'}: "${analysisResult.text_detected.substring(0, 50)}${analysisResult.text_detected.length > 50 ? '...' : ''}"`,
                            'info'
                        );
                    }
                    
                    // Update stats
                    socialSimStats.postsAnalyzed++;
                    socialSimStats.totalAnalysisTime += analysisTime;
                    if (analysisResult.risk_level === 'critical' || analysisResult.risk_level === 'high') {
                        socialSimStats.threatsDetected++;
                    }
                    updateSimulationStats();
                    
                } catch (error) {
                    console.error('Multimedia analysis failed:', error);
                    mediaUploadBtn.textContent = '❌ Analysis Failed';
                    mediaUploadBtn.className = 'mt-2 bg-red-600 text-white text-xs px-4 py-2 rounded';
                    
                    showNotification(`Multimedia analysis failed: ${error.message}`, 'error');
                    
                    // Reset after delay
                    setTimeout(() => {
                        mediaUploadBtn.textContent = originalText;
                        mediaUploadBtn.className = 'mt-2 bg-gray-700 hover:bg-gray-600 text-white text-xs px-4 py-2 rounded';
                    }, 3000);
                }
            }
            
            // Add multimedia analysis result to feed
            function addMultimediaToFeed(mediaData) {
                const socialFeed = document.getElementById('socialFeed');
                
                // Clear empty state if this is first post
                if (socialSimStats.postsAnalyzed === 1) {
                    socialFeed.innerHTML = '';
                }
                
                const { file, analysisResult, analysisTime, timestamp } = mediaData;
                
                const riskColors = {
                    critical: { bg: 'bg-red-900/30', border: 'border-red-500/50', text: 'text-red-400', badge: 'bg-red-500' },
                    high: { bg: 'bg-yellow-900/30', border: 'border-yellow-500/50', text: 'text-yellow-400', badge: 'bg-yellow-500' },
                    moderate: { bg: 'bg-orange-900/30', border: 'border-orange-500/50', text: 'text-orange-400', badge: 'bg-orange-500' },
                    low: { bg: 'bg-green-900/30', border: 'border-green-500/50', text: 'text-green-400', badge: 'bg-green-500' }
                };
                
                const riskLevel = analysisResult.risk_level || 'low';
                const colors = riskColors[riskLevel] || riskColors.low;
                
                const confidence = `${Math.round((analysisResult.confidence_score || 0) * 100)}%`;
                const fileType = file.type.startsWith('image/') ? '📷' : '🎥';
                const mediaIcon = file.type.startsWith('image/') ? '🖼️' : '📹';
                
                const riskLevelText = {
                    critical: 'CRITICAL THREAT',
                    high: 'HIGH RISK',
                    moderate: 'MODERATE RISK',
                    low: 'SAFE CONTENT'
                };
                
                const postElement = document.createElement('div');
                postElement.className = `${colors.bg} border ${colors.border} rounded-lg p-4 transition-all duration-300 hover:scale-[1.02]`;
                
                postElement.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            ${fileType}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="font-semibold text-white text-sm">@demouser</span>
                                <span class="text-gray-400 text-xs">${mediaIcon} Multimedia Upload</span>
                                <span class="text-gray-500 text-xs">${timestamp.toLocaleTimeString()}</span>
                                <span class="ml-auto px-2 py-1 ${colors.badge} text-white text-xs rounded-full font-bold animate-pulse">
                                    ANALYZED
                                </span>
                            </div>
                            
                            <div class="bg-gray-800/50 rounded-lg p-3 mb-3 border border-gray-700">
                                <div class="flex items-center mb-2">
                                    <span class="text-sm text-gray-300">${mediaIcon} ${file.name}</span>
                                    <span class="ml-auto text-xs text-gray-400">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                                </div>
                                
                                ${analysisResult.text_detected ? `
                                    <div class="bg-blue-900/30 border border-blue-500/50 rounded p-2 mb-2">
                                        <p class="text-xs text-blue-300 mb-1">📝 Extracted Text:</p>
                                        <p class="text-sm text-white">"${analysisResult.text_detected}"</p>
                                    </div>
                                ` : `
                                    <p class="text-xs text-gray-400 italic">No text detected in media</p>
                                `}
                            </div>
                            
                            <div class="bg-gray-900/50 rounded-lg p-3 mb-2">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-bold ${colors.text} text-sm">🛡️ ${riskLevelText[riskLevel] || 'ANALYSIS COMPLETE'}</span>
                                    <span class="text-gray-400 text-xs">Confidence: ${confidence}</span>
                                </div>
                                
                                <p class="text-xs text-gray-300 mb-2">${analysisResult.analysis_summary}</p>
                                
                                ${analysisResult.detected_indicators && analysisResult.detected_indicators.length > 0 ? `
                                    <div class="text-xs text-gray-400 mb-2">
                                        Indicators: ${analysisResult.detected_indicators.join(', ')}
                                    </div>
                                ` : ''}
                                
                                <div class="flex justify-between items-center text-xs text-gray-500">
                                    <span>Analysis time: ${Math.round(analysisTime)}ms</span>
                                    <span>🔍 Multimedia detection</span>
                                </div>
                            </div>
                            
                            ${riskLevel === 'critical' || riskLevel === 'high' ? `
                                <button class="bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded-full transition duration-300">
                                    🚨 Report Multimedia Threat
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                // Add to top of feed
                socialFeed.insertBefore(postElement, socialFeed.firstChild);
                
                // Remove oldest posts if more than 10
                while (socialFeed.children.length > 10) {
                    socialFeed.removeChild(socialFeed.lastChild);
                }
                
                // Animate in
                postElement.style.transform = 'translateY(-20px)';
                postElement.style.opacity = '0';
                setTimeout(() => {
                    postElement.style.transform = 'translateY(0)';
                    postElement.style.opacity = '1';
                }, 100);
            }
            
            // Show notification function
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-24 right-4 p-3 rounded-lg text-white text-sm font-medium z-50 transform transition-all duration-300 translate-x-full`;
                
                const colors = {
                    'info': 'bg-blue-600',
                    'success': 'bg-green-600',
                    'error': 'bg-red-600',
                    'warning': 'bg-yellow-600'
                };
                
                notification.className += ` ${colors[type] || colors.info}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
            
            // Initialize social simulation when switching to the page
            function switchToPage(pageId) {
                // Existing page switching logic
                const allPages = document.querySelectorAll('.page-section');
                const allNavLinks = document.querySelectorAll('.nav-link');
                
                allPages.forEach(page => page.classList.add('hidden'));
                allNavLinks.forEach(link => link.classList.remove('active-link'));
                
                const targetPage = document.getElementById(pageId);
                const targetNavLink = document.querySelector(`[href="#${pageId}"]`);
                
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                }
                if (targetNavLink) {
                    targetNavLink.classList.add('active-link');
                }
                
                // Initialize social simulation if switching to that page
                if (pageId === 'social-simulation') {
                    setTimeout(initializeSocialSimulation, 100);
                }
            }
            
            // Override existing navigation to include social simulation
            document.addEventListener('click', function(e) {
                if (e.target.matches('.nav-link') || e.target.closest('.nav-link')) {
                    e.preventDefault();
                    const link = e.target.matches('.nav-link') ? e.target : e.target.closest('.nav-link');
                    const href = link.getAttribute('href');
                    const pageId = href.substring(1);
                    switchToPage(pageId);
                }
            });
        });
    </script>
</body>
</html>